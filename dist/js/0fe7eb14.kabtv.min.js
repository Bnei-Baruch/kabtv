function DynamicGeoStreamLocator(r){angular.element(document.getElementById("player")).controller().buildDynamicGeoStream(r)}!function(){"use strict";angular.module("kabtv",["app.core","app.layout","kabtv.vod","kabtv.player"])}(),function(){"use strict";angular.module("blocks.exception",["blocks.logger"])}(),function(){"use strict";function exceptionHandlerProvider(){this.config={appErrorPrefix:void 0},this.configure=function(appErrorPrefix){this.config.appErrorPrefix=appErrorPrefix},this.$get=function(){return{config:this.config}}}function config($provide){$provide.decorator("$exceptionHandler",extendExceptionHandler)}function extendExceptionHandler($delegate,exceptionHandler,logger){return function(exception,cause){var appErrorPrefix=exceptionHandler.config.appErrorPrefix||"",errorData={exception:exception,cause:cause};exception.message=appErrorPrefix+exception.message,$delegate(exception,cause),logger.error(exception.message,errorData)}}angular.module("blocks.exception").provider("exceptionHandler",exceptionHandlerProvider).config(config),config.$inject=["$provide"]}(),function(){"use strict";function exception(logger){function catcher(message){return function(reason){logger.error(message,reason)}}var service={catcher:catcher};return service}angular.module("blocks.exception").factory("exception",exception),exception.$inject=["logger"]}(),function(){"use strict";angular.module("blocks.logger",[])}(),function(){"use strict";function logger($log){function error(message,data){$log.error("Error: "+message,data)}function info(message,data){$log.info("Info: "+message,data)}function success(message,data){$log.info("Success: "+message,data)}function warning(message,data){$log.warn("Warning: "+message,data)}var service={showToasts:!0,error:error,info:info,success:success,warning:warning,log:$log.log};return service}angular.module("blocks.logger").factory("logger",logger),logger.$inject=["$log"]}(),function(){"use strict";angular.module("blocks.router",["ngRoute","blocks.logger"])}(),function(){"use strict";function routehelperConfig(){this.config={},this.$get=function(){return{config:this.config}}}function routehelper($location,$rootScope,$route,logger,routehelperConfig){function configureRoutes(routes){routes.forEach(function(route){route.config.resolve=angular.extend(route.config.resolve||{},routehelperConfig.config.resolveAlways),$routeProvider.when(route.url,route.config)}),$routeProvider.otherwise({redirectTo:"/"})}function handleRoutingErrors(){$rootScope.$on("$routeChangeError",function(event,current,previous,rejection){if(!handlingRouteChangeError){routeCounts.errors++,handlingRouteChangeError=!0;var destination=current&&(current.title||current.name||current.loadedTemplateUrl)||"unknown target",msg="Error routing to "+destination+". "+(rejection.msg||"");logger.warning(msg,[current]),$location.path("/")}})}function init(){handleRoutingErrors(),updateDocTitle()}function getRoutes(){for(var prop in $route.routes)if($route.routes.hasOwnProperty(prop)){var route=$route.routes[prop],isRoute=!!route.title;isRoute&&routes.push(route)}return routes}function updateDocTitle(){}var handlingRouteChangeError=!1,routeCounts={errors:0,changes:0},routes=[],$routeProvider=routehelperConfig.config.$routeProvider,service={configureRoutes:configureRoutes,getRoutes:getRoutes,routeCounts:routeCounts};return init(),service}angular.module("blocks.router").provider("routehelperConfig",routehelperConfig).factory("routehelper",routehelper),routehelper.$inject=["$location","$rootScope","$route","logger","routehelperConfig"]}(),function(){"use strict";angular.module("app.core",["ngRoute","blocks.exception","blocks.logger","blocks.router","pascalprecht.translate","angulartics","angulartics.google.analytics","angularSpinner"])}(),function(angular){"use strict";angular.module("app.core").constant("API_BASE","http://dev.kab.tv/api/").constant("HELP_IMAGE_BASE","http://live.kab.tv/button.php?image=tech")}(angular),function(){"use strict";function configure($logProvider,$routeProvider,routehelperConfigProvider,exceptionHandlerProvider,$translateProvider){$logProvider.debugEnabled&&$logProvider.debugEnabled(!0),routehelperConfigProvider.config.$routeProvider=$routeProvider;var resolveAlways={ready:["dataservice",function(dataservice){return dataservice.ready()}]};routehelperConfigProvider.config.resolveAlways=resolveAlways,exceptionHandlerProvider.configure(config.appErrorPrefix),$translateProvider.useStaticFilesLoader({prefix:"static/i18n/locale-",suffix:".json"}).preferredLanguage("he")}function runBlock($translate,$location,$http,config){$http.defaults.headers.common.Accept="application/json";var lang=$location.absUrl().split("/")[3].toUpperCase();config.languages.hasOwnProperty(lang)||(lang="HEB"),config.lang=config.languages[lang],config.pageDirection="HEB"==lang?"rtl":"ltr",config.isVideo=$location.host().toLowerCase().indexOf("kab.fm")<0,$translate.use(config.lang.locale),document.title=$translate.instant("SITE_TITLE")}var core=angular.module("app.core"),config={lang:{},pageDirection:"rtl",isVideo:!0,appTitle:"Kab.tv",appErrorPrefix:"[Kab.tv Error] ",languages:{HEB:{key:"HEB",locale:"he",fullName:"Hebrew",caption:"עברית"},ENG:{key:"ENG",locale:"en",fullName:"English",caption:"English"},RUS:{key:"RUS",locale:"ru",fullName:"Russian",caption:"Русский"},SPA:{key:"SPA",locale:"es",fullName:"Spanish",caption:"Español"},GER:{key:"GER",locale:"de",fullName:"German",caption:"Deutsch"},FRE:{key:"FRE",locale:"fr",fullName:"French",caption:"Français"},POR:{key:"POR",locale:"pt",fullName:"Portuguese",caption:"Português"},ITA:{key:"ITA",locale:"it",fullName:"Italian",caption:"Italiano"}}};core.value("config",config),core.config(configure).run(runBlock),configure.$inject=["$logProvider","$routeProvider","routehelperConfigProvider","exceptionHandlerProvider","$translateProvider"],runBlock.$inject=["$translate","$location","$http","config"]}(),function(){"use strict";function dataservice($http,$q,config,exception,logger,API_BASE){function getHeaderLinks(){function getHeaderLinksComplete(data){return data.data}return $http.get(API_BASE+"nav_links",{params:{lang:config.lang.key,placeholder:"navbar"}}).then(getHeaderLinksComplete).catch(function(message){exception.catcher("XHR Failed for getHeaderLinks")(message)})}function getFooterLinks(){function getFooterLinksComplete(data){return data.data}return $http.get(API_BASE+"nav_links",{params:{lang:config.lang.key,placeholder:"footer"}}).then(getFooterLinksComplete).catch(function(message){exception.catcher("XHR Failed for getFooterLinks")(message)})}function getVodCategories(){function getVodCategoriesComplete(data){return data.data}return $http.get(API_BASE+"categories",{params:{lang:config.lang.key}}).then(getVodCategoriesComplete).catch(function(message){exception.catcher("XHR Failed for getVodCategories")(message)})}function getVodItems(category_id){function getVodItemsComplete(data){return data.data}return $http.get(API_BASE+"categories/"+category_id+"/vod_media").then(getVodItemsComplete).catch(function(message){exception.catcher("XHR Failed for getVodItems")(message)})}function getVodItem(clip_id){function getVodItemComplete(data){return data.data}return $http.get(API_BASE+"vod_media/"+clip_id).then(getVodItemComplete).catch(function(message){exception.catcher("XHR Failed for getVodItem")(message)})}function getUpdates(){function getUpdatesComplete(data){return data.data}return $http.get(API_BASE+"updates",{params:{lang:config.lang.key}}).then(getUpdatesComplete).catch(function(message){exception.catcher("XHR Failed for getUpdates")(message)})}function getStreams(){function getStreamsComplete(data){return data.data}return $http.get(API_BASE+"streams").then(getStreamsComplete).catch(function(message){exception.catcher("XHR Failed for getStreams")(message)})}function getPlaylist(){function getPlaylistComplete(data){return{date:(new Date).getDate(),list:data.data}}return $http.get(API_BASE+"playlists",{params:{lang:config.lang.key}}).then(getPlaylistComplete).catch(function(message){exception.catcher("XHR Failed for getPlaylist")(message)})}function getDynamicStream(url){return $http.jsonp(url,{})}function getEventStatus(){function getEventStatusComplete(data){return data.data.is_live}return $http.get(API_BASE+"event_status").then(getEventStatusComplete).catch(function(message){exception.catcher("XHR Failed for getEventStatus")(message)})}function getTabs(){var tabs=[{name:"TAB_UPDATES",url:""},{name:"TAB_SCHEDULE",url:"http://kab.tv/tvlist_gen.php"},{name:"TAB_QUESTIONS",url:"http://kab.tv/q.php"},{name:"TAB_SKETCHES",url:"http://www.kab.tv/classboard/classboard.php"}];return $q.when(tabs)}function prime(){function success(){isPrimed=!0,logger.info("Primed data")}return primePromise?primePromise:primePromise=$q.when(!0).then(success)}function ready(nextPromises){var readyPromise=primePromise||prime();return readyPromise.then(function(){return $q.all(nextPromises)}).catch(exception.catcher('"ready" function failed'))}var primePromise,isPrimed=!1,service={getHeaderLinks:getHeaderLinks,getFooterLinks:getFooterLinks,getTabs:getTabs,getVodCategories:getVodCategories,getVodItems:getVodItems,getVodItem:getVodItem,getUpdates:getUpdates,getStreams:getStreams,getPlaylist:getPlaylist,getDynamicStream:getDynamicStream,getEventStatus:getEventStatus,ready:ready};return service}angular.module("app.core").factory("dataservice",dataservice),dataservice.$inject=["$http","$q","config","exception","logger","API_BASE"]}(),function(){"use strict";angular.module("kabtv.vod",[])}(),function(){"use strict";function Vod($location,$window,$scope,dataservice,logger){function activate(){return calcVodItemsHeight(),angular.element($window).bind("resize",function(){calcVodItemsHeight(),$scope.$apply()}),getCategories().then(function(){logger.info("Loaded VOD categories"),vm.selectedCategory=vm.categories[0],changeCategory()})}function calcVodItemsHeight(){vm.vodItemsHeight=document.getElementById("vod").clientHeight-document.getElementById("vod-categories").clientHeight-5}function vodItemsStyle(){return{height:vm.vodItemsHeight+"px"}}function getCategories(){return dataservice.getVodCategories().then(function(data){return vm.categories=data,vm.categories})}function changeCategory(){return dataservice.getVodItems(vm.selectedCategory.id).then(function(data){return vm.vodItems=data,vm.vodItems})}function playVod(item){$location.path("clip/"),$location.search({mediaId:item.id})}var vm=this;vm.categories=[],vm.selectedCategory={},vm.vodItems=[],vm.vodItemsHeight=null,vm.changeCategory=changeCategory,vm.playVod=playVod,vm.vodItemsStyle=vodItemsStyle,activate()}angular.module("kabtv.vod").controller("Vod",Vod),Vod.$inject=["$location","$window","$scope","dataservice","logger"]}(),function(){"use strict";angular.module("kabtv.tabs",[])}(),function(){"use strict";function Tabs($sce,$window,$scope,dataservice,config,logger){function activate(){return calcTabContentHeight(),angular.element($window).bind("resize",function(){calcTabContentHeight(),$scope.$apply()}),getTabs().then(function(){logger.info("Loaded Tabs"),vm.selectedTab=vm.tabs[0]})}function getTabs(){return dataservice.getTabs().then(function(data){return vm.tabs=data,vm.tabs})}function isSelectedTab(tab){return vm.selectedTab==tab}function switchTab(index){vm.selectedTab=vm.tabs[index],vm.selectedTab.url&&(vm.selectedTabUrl=$sce.trustAsResourceUrl(vm.selectedTab.url+"?lang="+config.lang.fullName))}function calcTabContentHeight(){vm.tabContentHeight=document.getElementById("tabs").clientHeight-2;var element=document.getElementById("tabs-header");vm.tabContentHeight-=element?element.clientHeight:24}function tabContentStyle(){return{height:vm.tabContentHeight+"px"}}var vm=this;vm.tabs=[],vm.selectedTab={},vm.selectedTabUrl="",vm.tabContentHeight=null,vm.isSelectedTab=isSelectedTab,vm.switchTab=switchTab,vm.tabContentStyle=tabContentStyle,activate()}angular.module("kabtv.tabs").controller("Tabs",Tabs),Tabs.$inject=["$sce","$window","$scope","dataservice","config","logger"]}(),function(){"use strict";function Updates($sce,dataservice,logger){function activate(){return getItems().then(function(){logger.info("Loaded Updates")})}function getItems(){return dataservice.getUpdates().then(function(data){var updates=[];return data.forEach(function(update){updates.push({title:$sce.trustAsHtml(update.title),subtitle:$sce.trustAsHtml(update.subtitle),description:$sce.trustAsHtml(update.description),url_caption:$sce.trustAsHtml(update.url_caption),url:$sce.trustAsHtml(update.url),image_url:update.image_url})}),vm.updates=updates,vm.updates})}var vm=this;vm.updates=[],activate()}angular.module("kabtv.tabs").controller("Updates",Updates),Updates.$inject=["$sce","dataservice","logger"]}(),function(){"use strict";angular.module("app.layout",["kabtv.vod","kabtv.tabs"])}(),function(){"use strict";function Shell($window,$scope,config,logger){function activate(){calcMainPanelHeight(),angular.element($window).bind("resize",function(){calcMainPanelHeight(),$scope.$apply()}),logger.success(vm.title+" loaded!",null)}function calcMainPanelHeight(){vm.mainPanelHeight=$window.innerHeight-112}function mainPanelStyle(){return{height:vm.mainPanelHeight+"px"}}var vm=this;vm.pageDirection=config.pageDirection,vm.title=config.appTitle,vm.busyMessage="Please wait ...",vm.isBusy=!0,vm.showSplash=!0,vm.mainPanelHeight=null,vm.mainPanelStyle=mainPanelStyle,activate()}angular.module("app.layout").controller("Shell",Shell),Shell.$inject=["$window","$scope","config","logger"]}(),function(){"use strict";function Header($scope,$timeout,dataservice,config,logger,HELP_IMAGE_BASE){function activate(){return getLanguages(),onLanguageChanged(),helpImageUpdate(),$scope.$on("$destroy",handleDestroy),getHeaderLinks().then(function(){logger.info("Loaded top navigation links")})}function getLanguages(){return vm.languages=[],angular.forEach(Object.keys(config.languages),function(value){vm.languages.push(config.languages[value])}),vm.languages}function getHeaderLinks(){return dataservice.getHeaderLinks().then(function(data){return vm.links=data,vm.links})}function isCurrentLang(lang){return config.lang.key==lang.key}function onLanguageChanged(){vm.logoImage="./static/images/kab_tv_"+config.lang.key.toLowerCase()+".gif"}function helpImageUpdate(){var date=new Date;vm.helpImage=HELP_IMAGE_BASE+"&lang="+getHelpLang()+"&&time="+date.getTime(),vm.helpImageTimer=$timeout(helpImageUpdate,6e4)}function getHelpLang(){switch(config.lang.key.toLowerCase()){case"heb":return"he";case"rus":return"ru";case"spa":return"es"}return"en"}function handleDestroy(){$timeout.cancel(vm.helpImageTimer)}var vm=this;vm.links=[],vm.languages=[],vm.logoImage="",vm.helpImage="",vm.helpImageTimer=null,vm.isCurrentLang=isCurrentLang,activate()}angular.module("app.layout").controller("Header",Header),Header.$inject=["$scope","$timeout","dataservice","config","logger","HELP_IMAGE_BASE"]}(),function(){"use strict";function Footer(dataservice,logger){function activate(){return getFooterLinks().then(function(){logger.info("Loaded footer links")})}function getFooterLinks(){return dataservice.getFooterLinks().then(function(data){return vm.links=data,vm.links})}var vm=this;vm.links=[],activate()}angular.module("app.layout").controller("Footer",Footer),Footer.$inject=["dataservice","logger"]}(),function(){"use strict";function runBlock($rootScope,$timeout,$location,dataservice,config){function getEventStatus(){isLiveTimer=$timeout(function(){dataservice.getEventStatus().then(function(isLive){void 0===$rootScope.isLive&&$location.path().indexOf("clip")<0?($rootScope.isLive=isLive,$location.path("HEB"==config.lang.key||"RUS"==config.lang.key?"stream":isLive?"stream":"playlist")):$rootScope.isLive=isLive,getEventStatus()})},null==isLiveTimer?0:5e3)}function handleDestroy(){$timeout.cancel(isLiveTimer)}var isLiveTimer=null;$rootScope.$on("$destroy",handleDestroy),getEventStatus()}angular.module("kabtv.player",[]).value("streams",{}).run(runBlock),runBlock.$inject=["$rootScope","$timeout","$location","dataservice","config"]}(),function(){"use strict";function runBlock(routehelper){routehelper.configureRoutes(getRoutes())}function getRoutes(){return[{url:"/stream",config:{templateUrl:"app/player/stream.html",controller:"Stream",controllerAs:"vm"}},{url:"/clip",config:{templateUrl:"app/player/clip.html",controller:"Clip",controllerAs:"vm"}},{url:"/playlist",config:{templateUrl:"app/player/playlist.html",controller:"Playlist",controllerAs:"vm"}}]}angular.module("kabtv.player").run(runBlock),runBlock.$inject=["routehelper"]}(),function(){"use strict";function JerusalemTime(){return function(){var jarusalemOffset=72e4,now=new Date,jerusalem=now.getTime()+6e4*now.getTimezoneOffset()+jarusalemOffset,jerusalemNow=new Date(jerusalem),hours=jerusalemNow.getHours(),minutes=jerusalemNow.getMinutes();return parseInt(hours)<=9&&(hours="0"+hours),parseInt(minutes)<=9&&(minutes="0"+minutes),hours+":"+minutes}}angular.module("kabtv.player").service("JerusalemTime",JerusalemTime)}(),function(){"use strict";function KabtvJwPlayer(){function linkFunction(scope){function onFinishedFile(){$rootScope.$broadcast("the player is end")}scope.$watch("url",function(value){value&&-1==value.indexOf(".js",value.length-3)&&jwplayer("jwplayer-container").setup({file:value,type:"hls",autostart:!0,aspectratio:"16:9",width:"100%"})}),scope.$watch("file",function(value){value&&jwplayer("jwplayer-container").setup({file:value,autostart:!0,width:"100%",events:{onComplete:onFinishedFile}})}),scope.$on("$destroy",function(){var jwp=jwplayer("jwplayer-container");jwp.stop(),jwp.remove()})}var directive={restrict:"AE",templateUrl:"app/player/jwplayer.directive.html",scope:{url:"=url",file:"=file"},replace:!0,link:linkFunction};return directive}angular.module("kabtv.player").directive("kabtvJwPlayer",KabtvJwPlayer)}(),function(){"use strict";function KabtvWmvPlayer(){function linkFunction(scope,el){function isIE(){var ua=window.navigator.userAgent,msie=ua.indexOf("MSIE "),trident=ua.indexOf("Trident/");if(msie>0)return parseInt(ua.substring(msie+5,ua.indexOf(".",msie)),10);if(trident>0){var rv=ua.indexOf("rv:");return parseInt(ua.substring(rv+3,ua.indexOf(".",rv)),10)}return!1}scope.isIE=isIE(),scope.showFullScreen=!1,scope.gofs=function(){if(scope.url){var player=el.find("object")[0];player&&3==player.playState?player.fullScreen=!0:alert("Full Screen is only available when player is running")}},scope.$watch("url",function(newVal){var player=el.find("object")[0];if(scope.isIE)player.URL=newVal,player.object.controls.play();else{var clone=el.find("object").clone(),params=clone.find("param");angular.forEach(params,function(param){"src"==param.name&&(param.value=newVal)}),el.find("object").replaceWith(clone)}}),scope.$on("destroy",function(){var player=el.find("object")[0];player.close()})}var directive={restrict:"AE",templateUrl:"app/player/wmvplayer.directive.html",scope:{url:"=url"},replace:!0,link:linkFunction};return directive}angular.module("kabtv.player").directive("kabtvWmvPlayer",KabtvWmvPlayer)}(),function(){"use strict";function KabtvSoundPlayer(){function linkFunction(scope,el){scope.isPlay=!1,scope.isMute=!1,scope.audioPlayer=null,scope.toggleMute=function(){scope.isMute=!scope.isMute,scope.isMute?scope.audioPlayer.mute():scope.audioPlayer.unmute()},scope.togglePlay=function(){scope.isPlay=!scope.isPlay,scope.isPlay?soundManager.setup({url:"lib/soundmanager/swf",onready:function(){scope.audioPlayer=soundManager.createSound({id:"audio-player",url:scope.url}),scope.audioPlayer.play()}}):scope.audioPlayer.destruct()},scope.$watch("url",function(value){value&&(null===scope.audioPlayer?scope.togglePlay():(scope.audioPlayer.url=value,scope.isPlay=!1,scope.togglePlay()))}),el.bind("$destroy",function(){scope.audioPlayer&&(scope.audioPlayer.stop(),scope.audioPlayer.destruct())})}var directive={restrict:"AE",templateUrl:"app/player/soundmanager.directive.html",scope:{url:"=url"},replace:!0,link:linkFunction};return directive}angular.module("kabtv.player").directive("kabtvSoundPlayer",KabtvSoundPlayer)}(),function(){"use strict";function Stream($scope,$rootScope,$routeParams,$location,$timeout,streams,dataservice,JerusalemTime,config,logger){function activate(){return $routeParams.mediaLang&&(vm.currentPlayerLang=config.languages[$routeParams.mediaLang.toUpperCase()]),getJerusalemTime(),$scope.$on("$destroy",handleDestroy),$rootScope.$watch("isLive",handleLiveStateChange),0===Object.keys(streams).length?(logger.info("Loading streams from server"),dataservice.getStreams().then(function(data){logger.info("Streams loaded"),buildStreams(data),identifyStreams()})):(logger.info("Streams are already loaded"),void identifyStreams())}function buildStreams(data){angular.forEach(data,function(item){var lang=item.language.toUpperCase();item.language=config.languages[lang],streams[lang]||(streams[lang]={}),item.is_dynamic&&(item.resolved=!1),"video"==item.media_type?streams[lang][item.quality]=item:streams[lang].audio=item})}function identifyStreams(){vm.stream=null,vm.alternateLanguages=[],vm.alternateQualities=[];var langStreams=streams[vm.currentPlayerLang.key];angular.forEach(Object.keys(langStreams),function(value){var s=langStreams[value];"audio"==value?(vm.audioStream=s,vm.hasAudio=!0):(!s.is_live_only||$rootScope.isLive)&&(s.quality==vm.currentPlayerQuality?vm.stream=s:vm.alternateQualities.push(s))}),vm.stream&&(vm.stream.is_dynamic&&!vm.stream.resolved&&(logger.info("Loading dynamic stream for "+vm.stream.language.key+" "+vm.stream.quality),dataservice.getDynamicStream(vm.stream.url)),vm.isHLS="hls"==vm.stream.format.toLowerCase(),vm.isWMV="wmv"==vm.stream.format.toLowerCase(),angular.forEach(Object.keys(config.languages),function(value){value!=vm.currentPlayerLang.key&&(langStreams=streams[value],angular.forEach(Object.keys(langStreams),function(value){var s=langStreams[value];s.quality==vm.currentPlayerQuality&&vm.alternateLanguages.push(s)}))}),config.isVideo||vm.playAudio())}function buildDynamicGeoStream(r){logger.info("Dynamic stream for "+vm.stream.language.key+" "+vm.stream.quality+" loaded."),vm.stream.url=r.hlsUrl||r.netUrl,vm.stream.resolved=!0}function getJerusalemTime(){vm.jerusalemTimeTimer=$timeout(function(){vm.jerusalemTime=JerusalemTime(),getJerusalemTime()},null==vm.jerusalemTimeTimer?0:3e4)}function changeLanguage(lang){$location.search({mediaLang:lang.key})}function changeQuality(quality){$location.search({mediaLang:vm.currentPlayerLang.key,playerQuality:quality})}function playVideo(){vm.isVideo=!0,vm.isAudio=!1}function playAudio(){vm.hasAudio&&(vm.isVideo=!1,vm.isAudio=!0)}function showQualitySelection(){return vm.isVideo&&($rootScope.isLive||"HEB"==vm.currentPlayerLang.key||"RUS"==vm.currentPlayerLang.key)}function handleDestroy(){$timeout.cancel(vm.jerusalemTimeTimer)}function handleLiveStateChange(newVal,oldVal){"HEB"!=vm.currentPlayerLang.key&&"RUS"!=vm.currentPlayerLang.key&&!newVal&&oldVal&&$location.path("playlist")}var vm=this;vm.isVideo=!0,vm.isHLS=null,vm.isWMV=null,vm.isAudio=null,vm.stream=null,vm.audioStream=null,vm.currentPlayerLang=config.lang,vm.currentPlayerQuality=$routeParams.playerQuality||"high",vm.alternateLanguages=[],vm.alternateQualities=[],vm.hasAudio=null,vm.jerusalemTime=null,vm.jerusalemTimeTimer=null,vm.changeLanguage=changeLanguage,vm.changeQuality=changeQuality,vm.playVideo=playVideo,vm.playAudio=playAudio,vm.buildDynamicGeoStream=buildDynamicGeoStream,vm.showQualitySelection=showQualitySelection,activate()}angular.module("kabtv.player").controller("Stream",Stream),Stream.$inject=["$scope","$rootScope","$routeParams","$location","$timeout","streams","dataservice","JerusalemTime","config","logger"]}(),function(){"use strict";function Playlist($rootScope,$location,dataservice,config){function activate(){dataservice.getPlaylist().then(function(reqData){reqData&&(playListObj=buildPlayList(reqData),runNextItem())})}function buildPlayList(listData){var _playListObj={},_playedPlayList=[],_playedPlayListName="playedPlayList"+config.lang.key;return localStorage.getItem(_playedPlayListName)||localStorage.setItem(_playedPlayListName,""),listData.date==(new Date).getDate()&&(_playedPlayList=localStorage.getItem(_playedPlayListName).split(",")),angular.forEach(listData.list,function(_item){_playListObj[_item.id]=_item}),angular.forEach(_playedPlayList,function(_id){delete _playListObj[_id]}),_playListObj}function runNextItem(){var _playedPlayListName="playedPlayList"+config.lang.key,_item=getRandomItem();if(!_item)return localStorage.setItem(_playedPlayListName,""),void activate();var _playedPlayList=localStorage.getItem(_playedPlayListName);localStorage.setItem(_playedPlayListName,_playedPlayList+","+_item.id),delete playListObj[_item.id],vm.currentPlayListItem=_item}function getRandomItem(){var item,_counter=0,_randomNum=Math.floor(Math.random()*(Object.keys(playListObj).length-1));return angular.forEach(playListObj,function(_item){_randomNum==_counter&&(item=angular.copy(_item)),_counter++}),item}function handleLiveStateChange(newVal,oldVal){newVal&&!oldVal&&$location.path("stream")}var vm=this,playListObj={};vm.currentPlayListItem={},vm.runNextItem=runNextItem,activate(),$rootScope.$on("the player is end",runNextItem),$rootScope.$watch("isLive",handleLiveStateChange)}angular.module("kabtv.player").controller("Playlist",Playlist),Playlist.$inject=["$rootScope","$location","dataservice","config"]}(),function(){"use strict";function Clip($routeParams,$location,usSpinnerService,dataservice,logger){function activate(){return vm.clipId=$routeParams.mediaId,getClip().then(function(){logger.info("Loaded VOD Clip")}).finally(function(){usSpinnerService.stop("spinner-1")})}function gotoStream(){$location.path("stream"),$location.url($location.path())}function getClip(){return dataservice.getVodItem(vm.clipId).then(function(data){return vm.clip=data,vm.isWMV="WMV"==vm.clip.content_type,vm.clip})}var vm=this;vm.isWMV=null,vm.clip=null,vm.clipId=null,vm.gotoStream=gotoStream,activate()}angular.module("kabtv.player").controller("Clip",Clip),Clip.$inject=["$routeParams","$location","usSpinnerService","dataservice","logger"]}(),angular.module("kabtv").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("app/layout/footer.html",'<div data-ng-controller="Footer as vm"><nav class=links-nav><a data-ng-href={{item.url}} data-ng-repeat="item in vm.links" class=nav-link>{{item.caption}}</a></nav></div>'),$templateCache.put("app/layout/header.html",'<div id=header data-ng-controller="Header as vm"><div class="tree toL"><img src=static/images/tree.gif></div><div class=white-wrappwer><a href="/" class=toL><img data-ng-src={{vm.logoImage}}></a><div id=tech-support class=toR><a href="http://live.kab.tv/client.php?locale=he&style=silver_he&group=3" target=_blank onclick="if(navigator.userAgent.toLowerCase().indexOf(\'opera\') != -1 && window.event.preventDefault) window.event.preventDefault();this.newWindow = window.open(\'http://live.kab.tv/client.php?locale=he&style=silver_he&group=3&url=\'+escape(document.location.href)+\'&referrer=\'+escape(document.referrer), \'mibew\', \'toolbar=0,scrollbars=0,location=0,status=1,menubar=0,width=640,height=480,resizable=1\');this.newWindow.focus();this.newWindow.opener=window;return false"><img data-ng-src={{vm.helpImage}} alt="technical support" border=0 width=226 height=50></a> </div><nav class=langs-nav><a data-ng-repeat="item in vm.languages" data-ng-href=/{{item.key|lowercase}} data-ng-class="{\'nav-link\': true, selected: vm.isCurrentLang(item)}">{{item.caption}}</a></nav></div><nav class=links-nav><a data-ng-repeat="item in vm.links" data-ng-href={{item.url}} class=nav-link title={{item.title}}>{{item.caption}}</a></nav></div>'),$templateCache.put("app/layout/shell.html",'<div id=shell class={{vm.pageDirection}} data-ng-controller="Shell as vm"><header class=clearfix><div data-ng-include="\'app/layout/header.html\'"></div></header><div id=main-panel class=clearfix data-ng-style=vm.mainPanelStyle()><div id=left-panel data-ng-include="\'app/vod/vod.html\'"></div><div id=center-panel data-ng-view="">Center panel content</div><div id=right-panel data-ng-include="\'app/tabs/tabs.html\'"></div></div><footer id=footer class=clearfix><div data-ng-include="\'app/layout/footer.html\'"></div></footer></div>'),$templateCache.put("app/player/clip.html","<div class=clearfix><div class=back-to-stream data-ng-click=vm.gotoStream() data-ng-if=isLive>{{ 'PLAYER_BACK_TO_LIVE' | translate}}</div><span us-spinner spinner-key=spinner-1 spinner-start-active=true></span><div id=player><kabtv-jw-player data-ng-if=!vm.isWMV data-file=vm.clip.play_url></kabtv-jw-player><kabtv-wmv-player data-ng-if=vm.isWMV data-url=vm.clip.play_url></kabtv-wmv-player></div><div class=player-panel><h1 class=clip-title>{{vm.clip.title}}</h1><div id=clip-save-button><a data-ng-href={{vm.clip.download_url}} class=\"download-icon clip-icon-big\"><img src=static/images/save-big.gif title=\"{{ 'VOD_DOWNLOAD' | translate}}\" alt=\"{{ 'VOD_DOWNLOAD' | translate}}\"> {{ 'VOD_DOWNLOAD' | translate}}</a></div><p>{{vm.clip.description}}</p><br><div id=addthis-toolbox class=\"addthis_toolbox addthis_default_style addthis_16x16_style\"><a class=addthis_button_twitter></a> <a class=addthis_button_google_plusone_share></a> <a class=addthis_button_email></a></div></div></div>"),$templateCache.put("app/player/jwplayer.directive.html","<div id=player><div id=jwplayer-container></div></div>"),$templateCache.put("app/player/playlist.html","<div class=clearfix><kabtv-jw-player data-file=vm.currentPlayListItem.play_url></kabtv-jw-player><div class=player-panel><h1 class=vod-item-title>{{vm.currentPlayListItem.title}}</h1><p>{{vm.currentPlayListItem.description}}</p></div></div>"),$templateCache.put("app/player/soundmanager.directive.html",'<div id=audio-player><div class=play data-ng-class="{play: true, off: isPlay}" data-ng-click=togglePlay()></div><div class=mute data-ng-class="{mute: true, off: isMute}" data-ng-click=toggleMute()></div><div class=volume><div class=volume-rail></div></div></div>'),$templateCache.put("app/player/stream.html","<div class=clearfix><div class=tabs><div data-ng-click=vm.playVideo() data-ng-class=\"{'tab-button': true, 'select': vm.isVideo}\">{{'PLAYER_VIDEO' | translate}}</div><div data-ng-click=vm.playAudio() data-ng-class=\"{'tab-button': true, 'select': vm.isAudio}\" data-ng-if=vm.hasAudio>{{'PLAYER_AUDIO' | translate}}</div><div class=jerusalem-time translate=PLAYER_BROADCAST_TIME translate-value-time={{vm.jerusalemTime}}></div></div><div id=player><kabtv-jw-player data-ng-if=\"vm.isVideo && vm.isHLS\" data-url=vm.stream.url></kabtv-jw-player><kabtv-wmv-player data-ng-if=\"vm.isVideo && vm.isWMV\" data-url=vm.stream.url></kabtv-wmv-player><kabtv-sound-player data-ng-if=vm.isAudio data-url=vm.audioStream.url></kabtv-sound-player></div><div class=player-panel><label data-ng-repeat=\"item in vm.alternateLanguages\" class=\"langs {{(vm.currentPlayerLang.key == item.language.key) ? 'selected': '';}}\" data-ng-if=\"isLive || !item.is_live_only\">{{item.language.caption}} <input type=radio data-ng-model=vm.currentPlayerLang data-ng-value=item.language.key data-ng-change=vm.changeLanguage(item.language) name=vm.switcher-language-{{item.language.key}}></label><div class=quality-switcher data-ng-show=vm.showQualitySelection()><span>{{'STREAM_QUALITY' | translate}}:</span><label data-ng-repeat=\"item in vm.alternateQualities | orderBy: item.quality\" class=langs>{{item.quality.toUpperCase() | translate}} <input type=radio data-ng-model=vm.currentPlayerQuality value=item.quality name=vm.switcher-quality-{{item.quality}} data-ng-change=vm.changeQuality(item.quality)></label><label class=\"langs selected\">{{vm.currentPlayerQuality.toUpperCase() | translate}}</label></div></div></div>"),$templateCache.put("app/player/wmvplayer.directive.html",'<div id=wmv-player><object name=wmv-player type=application/x-ms-wmp data-ng-if=!isIE><param name=autostart value=true><param name=controller value=true><param name=volume value=50><param name=uiMode value=full><param name=animationAtStart value=true><param name=showDisplay value=false><param name=ShowAudioControls value=true><param name=ShowPositionControls value=false><param name=transparentAtStart value=false><param name=ShowControls value=true><param name=ShowStatusBar value=true><param name=ShowTracker value=false><param name=ClickToPlay value=false><param name=DisplayBackColor value=#000000><param name=DisplayForeColor value=#ffffff><param name=balance value=false><param name=src value={{url}}><param name=fullScreen value={{showFullScreen}}><param name=type value=application/x-ms-wmp></object><object name=wmv-player classid=CLSID:6BF52A52-394A-11d3-B153-00C04F79FAA6 style="background-color: rgb(0, 0, 0)" data-ng-if=isIE><param name=rate value=1><param name=balance value=0><param name=defaultFrame value=""><param name=playCount value=1><param name=autoStart value=1><param name=currentMarker value=0><param name=invokeURLs value=-1><param name=baseURL value=""><param name=volume value=50><param name=mute value=0><param name=uiMode value=full><param name=stretchToFit value=0><param name=windowlessVideo value=-1><param name=enabled value=-1><param name=enableContextMenu value=-1><param name=fullScreen value=0><param name=SAMIStyle value=""><param name=SAMILang value=""><param name=SAMIFilename value=""><param name=captioningID value=""><param name=enableErrorDialogs value=0><param name=autostart value=true><param name=controller value=true><param name=volume value=50><param name=uiMode value=full><param name=animationAtStart value=true><param name=showDisplay value=false><param name=ShowAudioControls value=true><param name=ShowPositionControls value=false><param name=transparentAtStart value=false><param name=ShowControls value=true><param name=ShowStatusBar value=true><param name=ShowTracker value=false><param name=ClickToPlay value=false><param name=DisplayBackColor value=#000000><param name=DisplayForeColor value=#ffffff><param name=balance value=false><param name=enabled value=true><param name=mute value=false><param name=bgcolor value=#000000><param name=windowlessVideo value=1></object><div><a class=full-screen-button data-ng-click=gofs()><img src=static/images/fs.gif alt="{{ \'PLAYER_FULLSCREEN\' | translate}}" width=14 height=14> {{ \'PLAYER_FULLSCREEN\' | translate}}</a></div></div>'),$templateCache.put("app/tabs/tabs.html",'<div id=tabs data-ng-controller="Tabs as vm"><div id=tabs-header data-ng-repeat="item in vm.tabs" data-ng-class="{\'tab-button\': true, \'select\': vm.isSelectedTab(item)}" data-ng-click=vm.switchTab($index)>{{item.name | translate}}</div><div data-ng-include="vm.selectedTab.name + \'.tpl\'" class=forIframe data-ng-style=vm.tabContentStyle()></div></div><script type=text/ng-template id=TAB_UPDATES.tpl><div id="tabs-content" data-ng-include="\'app/tabs/updates.html\'"></div></script><script type=text/ng-template id=TAB_SCHEDULE.tpl><iframe data-ng-src="{{vm.selectedTabUrl}}" frameborder="0"></iframe></script><script type=text/ng-template id=TAB_QUESTIONS.tpl><iframe data-ng-src="{{vm.selectedTabUrl}}" frameborder="0"></iframe></script><script type=text/ng-template id=TAB_SKETCHES.tpl><iframe data-ng-src="{{vm.selectedTabUrl}}" frameborder="0"></iframe></script>'),$templateCache.put("app/tabs/updates.html",'<div id=updates data-ng-controller="Updates as vm"><div data-ng-repeat="update in vm.updates" class="update-item clearfix"><div class=ad data-ng-if=update.url><div class=header><a data-ng-href={{update.url}} class=link target=_blank><span class=title data-ng-bind-html=update.title></span> <span class=subtitle data-ng-bind-html=update.subtitle></span></a></div><div class=body data-ng-if=update.description><div class=description data-ng-bind-html=update.description></div></div><div class=body data-ng-if=update.image_url><a data-ng-href={{update.url}} target=_blank><img data-ng-src={{update.image_url}}></a></div><a data-ng-if=update.url_caption data-ng-href={{update.url}} class="url toR" target=_blank>{{update.url_caption}}>></a></div><div class=ad data-ng-if=!update.url><div class=header><span class=title data-ng-bind-html=update.title></span> <span class=subtitle data-ng-bind-html=update.subtitle></span></div><div class=body data-ng-if=update.description><div class=description data-ng-bind-html=update.description></div></div><div class=body data-ng-if=update.image_url><img data-ng-src={{update.image_url}}></div></div></div></div>'),$templateCache.put("app/vod/vod.html",'<div id=vod data-ng-controller="Vod as vm"><select id=vod-categories data-ng-model=vm.selectedCategory data-ng-change=vm.changeCategory() data-ng-options="item.name for item in vm.categories"></select><div id=vod-items data-ng-style=vm.vodItemsStyle()><div data-ng-repeat="item in vm.vodItems" class=vod-item><div data-ng-click=vm.playVod(item) class=clearfix><img data-ng-src={{item.image_url}} class="vod-item-image toL" title={{item.title}} alt={{item.title}} width=70 height=70><h2 class=vod-item-title>{{item.title}}</h2><p class=vod-item-description>{{item.description}}</p><p class=vod-item-duration>{{item.duration}}</p></div></div></div></div>')
}]);